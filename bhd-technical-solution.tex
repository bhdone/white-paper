\chapter{BHD's Technical Solution}
\begin{flushleft}
    BHD uses PoC as the basis of its consensus mechanism, it ensures sound development of the entire crypto currency by designing a long-term incentive economic model. At the same time, it has made some improvements to the existing PoC and upgraded it to the CPoC consensus.
\end{flushleft}
\section{BHD Distribution and Mining\\Mechanism}
\begin{tabular}{ |p{4cm}|p{8cm}| }
    \hline
    \textbf{Total supply}                           & 21 million                                                                                               \\[5pt]
    \hline
    \rowcolor{lightgray!20}\textbf{Development team}   & $10\%$: 2.1 million. Way: pre-mined                                                                      \\[5pt]
    \hline
    \textbf{Operation team}                         & $5\%$: 1.05 million. Way: obtain from blocks generated during miners mining                              \\[5pt]
    \hline
    \rowcolor{lightgray!20}\textbf{Miner}              & $85\%$: 17.85 million. Way: mining                                                                       \\[5pt]
    \hline
    \textbf{Avg. block time}                        & 3 minutes                                                                                                \\[5pt]
    \hline
    \rowcolor{lightgray!20}\textbf{Initial block size} & 15 BHD / Block, 2MB block size                                                                           \\[5pt]
    \hline
    \textbf{Halve period}                           & In 4 years, the first halving time is about 582688 block height                                          \\[5pt]
    \hline
    \rowcolor{lightgray!20}\textbf{Current TPS}        & 70 transactions / sec                                                                                    \\[5pt]
    \hline
    \textbf{Stake}                                  & 1T hard disk stake 3 BHD. Note: 1T hard disk is evaluated based on computing power, not absolute values. \\[5pt]
    \hline
\end{tabular}
\begin{flushleft}
    In the first month, after mining of the genesis block, miner can mine with no condition limitation. From the second month onwards, the $30\%$ return that does not meet the conditional capacity mining revenue remains the same. For the remaining $70\%$, $43\%$ is directly accumulated to the next eligible conditional address, and the remaining $27\%$ is allocated to the BHD Development Foundation. For every 33,600 blocks (about 10 weeks) after, the BHD Development Foundation's revenue will be reduced by $2\%$, and the partial accumulation will be reduced to the next block that meets the conditions for mining. By the first halving, the BHD Foundation's revenue will be reduced to $5\%$ and stay at that amount. $65\%$ of the income that does not meet the conditional capacity mining will accumulating to the next block that meets the conditional mining; If the conditions are satisfied, miner would get $95\%$ of the mining reward, then the $5\%$ remaining reward would go to the foundation for marketing.
\end{flushleft}
\begin{flushleft}
    Conditioned proof of capacity, or CPoC, would lead the miners, mining pools, the foundation and other participants to engage in a positive business cycle, so that the whole system would always have a dominant temporary commercial vested beneficiary (this vested beneficiary could change with variables such as time, price and mining difficulty) to promote the whole ecosystem.
\end{flushleft}
\section{BHD Economic Model}
\begin{flushleft}
    BHD's economic model / consensus mechanism has been upgraded based on the Burst PoC2 (Proof of Capacity), and is called: CPoC (Conditioned-Proof of Capacity).
\end{flushleft}
\begin{flushleft}
    The model will solve the problems listed below:
\end{flushleft}
\subsection{Economic Model Attack}
\begin{flushleft}
    The main purpose of miners mining is the payback period, and the benefits will inevitably lead to the sale of all mining output, resulting in market crash, lower prices and thinner profits. The CPoC mining model binds miner to its ecosystem, and uses output of mining as future input of mining, to make the entire BHD system grow automatically.
\end{flushleft}
\subsection{POW High Maintenance Cost}
\begin{flushleft}
    It requires a huge amount of power to keep the chain with PoW consensus safe. In good days, it works fine for each part of the system, but in hard times, miners have to pay bills by selling, and it is not easy to keep the miners in the system, if they always have to consider how much energy has been consumed.
\end{flushleft}
\subsection{Lack of Long-Term Economic Incentive}
\begin{flushleft}
    Without operational incentive funds, the promotional efficiency and market confidence is low. even the core technology might fail to get continuous update. As a result, effective development and iterations are non-existent in the long-run, the team may even create a fork in the subsequent version, and users will no longer be able to tell which is the main-net.
\end{flushleft}
\subsection{Mining Machine Monopoly}
\begin{flushleft}
    The POW consensus mechanism will inevitably lead to a race for mining machines. In order to obtain higher hash power, special-purpose mining machines with higher performance will be developed inevitably, and ordinary people cannot participate in mining. The CPoC mechanism is much more accessible because of slow iteration of hard disk manufacturers and low entry barrier. In traditional businesses, the vendor is normally not a competitor to users. But in the PoW systems, the ASIC manufacturer is the biggest miner. It can be easily understood that the miner's competitor is the miner's vendor, since device suppliers take most of the profit by providing mining machines, miner is radically the risk-free arbitrage of ASIC manufacturers.
\end{flushleft}
\subsection{Power Resources Monopoly}
\begin{flushleft}
    The power resources monopoly leads to no PoW ecosystem expansion, as the cost of mining exceeds the return. For those CPoC miners, the hard disks have much lower power requirement, thus the return of mining is higher. The linear hedge ratio of civil computer hardware can also be taken into consideration to ensure that miners can hedge the price fluctuation risk in the secondary market under the condition of relative safety and cost protection.
\end{flushleft}
\section{BHD Architecture and Consensus Mechanism}
\begin{flushleft}
    The BHD wallet is derived from Bitcoin and the consensus from Burst's PoC2.
\end{flushleft}
\begin{flushleft}
    Bitcoin started in Jan 2009, the stability of wallet and blockchain is widely accepted after 10 years of iterations, it is safe and reliable to implement the PoC consensus on the Bitcoin QT wallet.
\end{flushleft}
\begin{flushleft}
    Burst Coin started in August 2014, and upgraded to PoC2 in 2018 after 4 years of iteration. Combining the advantages of Bitcoin and Burst, BHD has currently become the most reliable public chain with PoC consensus algorithm.
\end{flushleft}
\begin{flushleft}
    Since its launch on August 3rd 2018, BHD has grown steadily in computing power, withstood numerous tests, attacks, and cracks, and so far no major loopholes have emerged.
\end{flushleft}
\begin{flushleft}
    By adopting the mature POC2 mechanism, a stable and reliable consensus mechanism is introduced to build community confidence in the BHD public chain. Since being compatible with Burst Plot files, miners can get both BHD and BurstCoin benefits, with only an additional operation.
\end{flushleft}
\begin{flushleft}
    The BHD wallet inherits Bitcoin's excellent P2P network architecture and UTXO system, which is mature and stable.
\end{flushleft}
\begin{flushleft}
    The wallet client could implement any latest developments from the Bitcoin community: lightning network, script upgrades, and much more. The interface standard is kept same as that of Bitcoin, allowing users to integrate easily.
\end{flushleft}
\begin{flushleft}
    The CPoC ecosystem model includes mining pool, miner, crypto currency holder, wallet, exchanges and hardware vendor. The positive inner cycle and entrance of outside resources would bring expansion and development to this ecosystem, the rising price of BHD would attract more miners; more miners coming to the system will lead to further price increase.
\end{flushleft}
\begin{flushleft}
    The cost of PoW is influenced by four factors: cost of dishonesty, cost of mining, level of difficulty and cost of mining devices. In the end, the PoW would become another low gross margin industry, the former windfall profits was because of insufficient scale, fluctuation of secondary market and limited device vendors.
\end{flushleft}
\begin{flushleft}
    When it comes to PoC, due to the relatively low power consumption by hardware, miners can obtain other coins in the future symbiotic ecosystem of POC almost free of charge without any risk.
\end{flushleft}
\begin{flushleft}
    The CPoC system, could give miners the choice to have most of the profits, incur cost for them to be the holder of other PoC coins, and avoid any malicious act. At the same time, the CPOC system attaches great importance to the release of distributional right and packaging right without barrier, which brings equity to the system. BHD network architecture and the participants:
\end{flushleft}
\begin{flushleft}
    \centering\textbf{BHD network architecture}
\end{flushleft}
\input{graph-bhd_network_arch}
\subsection{Miners Mining Procedure}
\subsubsection{Plot}
\begin{flushleft}
    Miner plots file at local hard disk, and uses hash value to fill the disk. The larger the storage space, the more hash value could be filled, and higher block generation rate. Hash algorithm uses Shabal256, which is anti-ASIC.
\end{flushleft}
\subsubsection{Transaction}
\begin{flushleft}
    Wallet makes up the P2P network(inherited from BTC): Transactions happen between wallets.
\end{flushleft}
\subsubsection{Forging}
\begin{flushleft}
    Miner use wallet to listen to the P2P network, once a block is received, the packaging process of the next block starts. Wallet composes a block, sends the hash value of the block to miner, then miner finds the matching nonce. Once wallet receives nonce, it turns the nonce to deadline, wait for the time to end and then broadcast the block.
\end{flushleft}
\subsubsection{Verify}
\begin{flushleft}
    Receives the block, verifies it.
\end{flushleft}
\subsection{Plotting - Create Plot File}
\subsubsection{Algorithms and acronyms}
\begin{flushleft}
    \textbf{Shabal}: Shabal is the name of the crypto/hash function used in BHD. It is a rather heavy and slow crypto compared to many other alternatives like SHA256. Thus Shabal is a good crypto for Proof of capacity coins like BHD, because we store the precomputed hashes while it is still fast enough to do smaller live verifications. BHD uses the 256bit version of Shabal, which is also known as Shabal256.
\end{flushleft}
\begin{flushleft}
    \textbf{Hash / Digest}: A hash or digest in this context is a 32Byte (256bit) long result of the Shabal256 Crypto.
\end{flushleft}
\begin{flushleft}
    \textbf{Nonce}: When generating a plot file, you generate something that is called nonces. Each nonce contains 256Kilobyte of data that can be used by miners to calculate Deadlines. Each nonce has its individual number. This number can range between 0-18446744073709551615. The number is also used as a seed when creating the nonce, so each nonce has its own unique set of data. One plot file can contain many nonces.
\end{flushleft}
\begin{flushleft}
    \textbf{Scoop}: Each nonce is sorted into 4096 different places of data. These places are called scoop numbers. Each scoop contains 64byte of data which holds 2 hashes. Each of these hashes are xored with a final hash (we get to final hash while generating a nonce chapter).
\end{flushleft}
\begin{flushleft}
    \textbf{Plot ID}: When you create your plot file it will be bound to a specific BHD account. The numeric account ID is used when you create your nonces. Because of this all miners have different plot files even if they use the same nonce numbers.
\end{flushleft}
\subsection{Generating a Nonce}
\begin{flushleft}
    The first step in creating a nonce is to make the first seed. The seed is a 16byte long value containing the Plot ID and the nonce number. When this is done we start to feed the Shabal256 function to get our first hash.
\end{flushleft}
\begin{flushleft}
    We have produced the first hash. This is the last hash in the nonce. Hash $\#8191$. Now we take this produced hash ($\#8191$) and pre-append it to the starting seed. The result will now be our new seed for the next round of shabal256 computation.
\end{flushleft}
\begin{flushleft}
    We now have produced two hashes.
\end{flushleft}
\begin{flushleft}
Hash $\#8191$ and Hash $\#8190$. This time we pre-append Hash $\#8190$ to the last seed we used. The result will now be a new seed to feed Shabal256.
\end{flushleft}
\begin{flushleft}
    Once again, we have created a new hash. This procedure of pre-appending resulting hashes to a new seed will continue for all 8192 hashes we create for a nonce. After iteration 128 we have reached more than 4096 bytes in the seed. For all remaining iterations we will only read the last 4096 generated bytes.
\end{flushleft}
\begin{flushleft}
    Once we have created 8192 hashes we are now going to make a Final hash. This is done by using all 8192 hashes and the first 16 bytes as seed.
\end{flushleft}
\input{graph-making_hash}
\begin{flushleft}
    The final hash will now be used to xor all other hashes individually.
\end{flushleft}
\begin{flushleft}
    We have now created our nonce and can store it in a plot file before we continue to the next nonce.
\end{flushleft}
\subsection{POC Format}
\begin{flushleft}
    The POC2 nonce format is created the same way as POC1 with a slight addition to the end of the process. To create a POC2 formatted nonce we need to shuffle the data around.
\end{flushleft}
\begin{flushleft}
    The data shuffling process:
\end{flushleft}
\begin{flushleft}
    Dividing the nonce in 2 halves, get a range with scoops 0-2047 and 2048-4095. Name 0-2047 the low scoop range and 2048-4095 the high scoop range. Take the second hash from a scoop in the low range, and swap it with the second hash in its mirror scoop found in the high range.
\end{flushleft}
\begin{flushleft}
    The mirror scoop is calculated like this:
    \begin{equation}
        MirrorScoop = 4095 - CurrentScoop
    \end{equation}
\end{flushleft}
\input{graph-poc_format}
\subsection{Plot Structure}
\begin{flushleft}
    When we are mining we read nonce from one or more plot files. The miner software will open a plot file and seek the scoop locations to read the scoops data. If the plot file is unoptimized, the scoop location will be on more than one place. In the following example the miner will be seeking and reading scoop $\#403$.
\end{flushleft}
\input{graph-seeking_reading_scoop_403}
\begin{flushleft}
    This is not the most effective way since the miner will spend a lot of time to seek new locations on the storage device to be able to read the scoops. To prevent this, we can optimize plots or use plotter software that creates optimized plots from the beginning. Optimization is done by reordering the data in the plot file and grouping all data from the same scoop number together.
\end{flushleft}
\input{graph-unoptimized_optimized}
\begin{flushleft}
    Basically, what we have done is to divide the plot file into 4096 portions where we split up all the nonces data based on scoop numbers. When the miner now wants to read Scoop 4096 it only seeks one time and read all data sequentially. This provides better performance.
\end{flushleft}
\subsection{Mining and Block Forging}
\subsubsection{Algorithms and acronyms}
\begin{flushleft}
    \textbf{Shabal / Sha256 / Curve25519}\\
    Shabal, Sha256 or Curve25519 is the name of the crypto/hash function used in BHD. Shabal is the main function in BHD. It is a rather heavy and slow crypto compared to many other alternatives like SHA256. Thus Shabal is a good crypto for Proof of capacity coins like BHD because we store the precomputed hashes while it is still fast enough to do smaller live verifications. BHD uses the 256bit version of Shabal, which is also known as Shabal256.
\end{flushleft}
\begin{flushleft}
    \textbf{Deadline}\\
    When you mine and process Plot files, you end up with a value called deadline. These values represent the number of seconds that must pass since the forging of last block before block-forging is allowed. If no one else forges a block during this period, you can forge a block and get a block reward.
\end{flushleft}
\begin{flushleft}
    \textbf{Block Reward}\\
    If you are lucky enough to cast a block, you will get BHD. This is called a block reward. For every 420000 blocks, the block reward is reduced by $50\%$. The initial reward is 25 BHDs per block, of which 1.25 belongs to the Foundation. Under full conditions, the miners'Union gets 23.75 BHDs.
\end{flushleft}
\begin{flushleft}
    \textbf{Base Target}\\
    Base target is calculated from the last 288 blocks. This value adjusts the difficulty for the miners. The lower the base target, the harder it is for a miner to find a low deadline. It gets adjusted in a way that BHD can have an average of 5 minutes for each block.
\end{flushleft}
\begin{flushleft}
    \textbf{Network Difficulty}\\
    Network Difficulty, or NetDiff in short, is a value that can be read as an estimate on the total amount of space in Byte dedicated to mine BHD. This value changes with every block in relation to base target.
\end{flushleft}
\begin{flushleft}
    \textbf{Block Height}\\
    Every block forged gets an individual number. Every new block forged gets the previous block's number + 1. This number is called block height, and can be used to identify a specific block.
\end{flushleft}
\begin{flushleft}
    \textbf{Generation Signature}\\
    Generation signature is a based from the previous block merkle root and block height, This value is then used by miners to forge a new block. Generation signature is 32 bytes long.
\end{flushleft}
\subsection{Mining Process}
\begin{flushleft}
    The first thing that happens when you start mining, is that the miner talks to the wallet and asks for mining information. This information contains a new generation signature, base target, and the next block height. Before the wallet sends over this info, it creates the generation signature by taking the previous generation signature together with plot id and runs this though shabal256 to get the new hash. The miner will now take the new 32 byte generation signature, and the 8byte block height, and put them together as a seed for Shabal256. The result will be a hash value called Generation hash.
\end{flushleft}
\input{graph-generation_hash}
\begin{flushleft}
    Now, the miner will do a small mathematical operation on this hash to find out which scoop number to use when processing the plot files. This is done by taking the generation hash modulo 4096, as there are only that many scoops
\end{flushleft}
\begin{equation}
    ({GenHash}) _{mod} ({4096}) = Scoop Number
\end{equation}
\begin{flushleft}
    Next step for the miner is to read all the 64-byte long scoops from all nonces in all plot files. It will process them individually through shabal256 together with the new generation signature to get a new hash called target. This target is now divided with base target and the first 8bytes of the result is the value deadline.
    \begin{equation}
        Target = shabal256 (scoop data, generation signature)
    \end{equation}
    \begin{equation}
        Deadline = \frac{target}{base target};
    \end{equation}
\end{flushleft}
\input{graph-generate_the_deadline}
\begin{flushleft}
    To prevent so-called "nonce spamming" to the wallet, the miner usually checks if the current deadline found is lower than the lowest one it has found so far. Usually there is also a max value that can be set, as ridiculously large deadlines are of no use to anyone. After these checks, the miner submits information to the wallet. This information contains the numeric plot ID bound to the plot file, and the nonce number that contains the scoop data used to generate the deadline.
\end{flushleft}
\subsection{Block Forging Process}
\begin{flushleft}
    \textbf{Handling Deadlines}\\
The wallet has now received the information submitted by the miner, and will now create the nonce to be able to find and verify the deadline for itself. After this is done, the wallet will now check and see if an equal amount or more seconds has passed as defined by the deadline. If not, the wallet will wait until it has. If a valid forged block from another wallet is announced on the network before the deadline has passed, the wallet will discard the mining info submitted since it is no longer valid. If the miner submits new information, the wallet will create that nonce and check if the deadline value is lower than the previous value. If the new deadline is lower, the wallet will use that value instead. When the deadline is valid, the wallet will now start to forge a block.
\end{flushleft}
\begin{flushleft}
    \textbf{Forging}\\
    The wallet will start by getting all of the unconfirmed transactions it has received from users or from the network. It will try to fit as many of these transactions possible until it hits the limit of 8M, or until all transactions are processed. For each transaction the wallet reads, it will do checks. For example, if the transaction has a valid signature, if it has a correct timestamp, etc. The wallet will also sum up all of the added transactions amounts and fees.
\end{flushleft}
\subsubsection{BHD Wallet Vs BTC Wallet}
\begin{flushleft}
    BHD inherits the BTC wallet in code level, but differs from BTC in the following aspects:
\end{flushleft}
\begin{enumerate}
    \item BHD expands the block size to 2 MB/block, Blocks become larger, and a single block can contain more transactions to speed up transfers.
    \item The avg block generation time is set to 3 mins. Block generation time is halved and the transaction time has increased.
    \item Initial reward is set to 15 BHD/block, halves each 4 years. The initial reward is halved, giving the community more time to develop, since early adopters are not taking too much advances, the miner community could share more profits.
\end{enumerate}
\begin{tabular}{ |p{5cm}|p{3cm}|p{3cm}| }
    \hline
    \rowcolor{lightgray} \textbf{Parameter} & \textbf{BTC} & \textbf{BHD} \\[5pt]
    \hline
    Total Supply & 21,000,000 & 21,000,000 \\[5pt]
    Block Time & 10mins & 3mins \\[5pt]
    Block Size & 1M & 2M \\[5pt]
    Halving Cycle & every 4 years & every 4 years \\[5pt]
    Initial Block Reward & 50 BTC & 15 BHD \\[5pt]
    \hline
\end{tabular}
\section{BHD Technical Characteristics}
\begin{tabular}{ |p{12cm}| }
    \hline
    POC2 consensus mechanism\\[5pt]
    \hline
    5-minute block generation time, the transaction speed is faster\\[5pt]
    \hline
    8 M block size to improve network efficiency\\[5pt]
    \hline
    Zero knowledge proof will be added once whole network capacity reaches 3000P. Uses hard disk mining, anti-ASIC, mine without special equipment\\[5pt]
    \hline
    Sustainable, low energy consumption, low noise\\[5pt]
    \hline
\end{tabular}
\subsection{Blockchain}
\begin{flushleft}
    Block includes proof sub block, signature sub block and transaction sub block. The arrow indicates that the sub-block contains the signature of the miner which has the arrow pointing to the sub-block. Our challenge is generated by sub-block hashed from blocks before current one.
\end{flushleft}
\subsection{Possible Attack and Prevention Design}
\begin{flushleft}
    While creating blocks, miners can try different transaction combinations, making the blocks created biased towards themselves. In our block structure, the independence of the proof sub-block prevents this attack.
\end{flushleft}
\subsubsection{Challenge Grinding}
\begin{itemize}
    \item In the process of mining, miners can divide their space into m parts, then continuously refactor $t = 2\Delta$ on the blockchain.
    \item Then you can try $i_{th}$ block proof, making $i + \Delta$ quality the biggest. Based on linear summation calculated quality, according to the above attack method, it will result in an attacker having $\frac{1}{2}$ times chance to get bigger quality.
    \item By redefining the blockchain quality, the gains from this attack can be reduced. The calculation of quality is changed from linear superposition to multiplication.
    \item Under this definition, the probability increases obtained by the attacker will be reduced to $\log(m)$. At the same time, let the challenge of continuous $\Delta$ block be determined by the same block, which will further reduce the impact of the attack.
\end{itemize}
\subsection{Transaction}
\begin{flushleft}
    BHD transaction structure is the same as Bitcoin, that is, UTXO to UTXO's chain. This type of transaction design has also been available for many years, and it is also an effective way to achieve its basic properties.
\end{flushleft}
